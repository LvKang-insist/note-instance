### Settings 类

​		决定一个工程中有哪些模块是需要被处理的。

```java
public interface Settings extends PluginAware, ExtensionAware {
	
	//默认的文件名称
    String DEFAULT_SETTINGS_FILE = "settings.gradle";
    //将指定的 project 加载到的构建中
    void include(String... projectPaths);

}
```

​		Settings 类如何被 gradle 初始化完全取决于 settings.gradle 文件的配置。setting.gradle 中就需要指定有哪些模块需要被处理。

```java
include  ':app', ':core', ':detegateManager', ':tabHome', ':tabShop', ':tabDiscover', ':tabMall', ':tabMine', ':ui'
```

​		如上就是有多个模块被加载到构建中，Settings 会在 gradle 生命周期的初始化阶段执行，确定要构建的模块，并创建 project 对象

###  **SourceSet**  类

​		gradle 是如何从从 src/main/java/package/ 下面去读取我们的源码，然后生成字节码文件呢？其实就是通过 SourceSet 类的配置中拿到的。

​		SourceSet 类决定了我们所有的代码，资源，第三方库等存放的位置。

​		gradle 中约定大于配置，只要没有配置，那就是按约定的来。gradle 默认从 java 文件下获取源码，从 res 文件下获取资源 进行编译。这些约定可以进行修改。

​		通过 SourceSet 类我们可以修改默认的存放路径，如 so 的路径，res 的路径，java 文件的路径等。如下所示：

​	  

```java
android {
    sourceSets {
            main {
                //修改 so 文件存放的位置
                jniLibs.srcDirs = ['libs']
            }
        }
}
```

使用上面的配置后，gradle 在加载 so 文件时就会从 libs 下进行加载。

修改资源路径：如果一个项目太过庞大，其代码还可以通过创建 package 来整理一下，看起来会更加简洁，容易寻找。但是资源文件却不行，默认只有一个 res 目录，所有的自愈都需要放在 res 中。但是通过 SourceSet 类可以指定多个 res 文件夹，这些文件夹里面就可以存放不同模块下的资源文件了。如下：

在 main 文件下新建文件夹 res-ad 用来存放广告资源，res-play 存放游戏资源。创建完成后在 build.gradle 中的 android 下添加如下代码：

```java
 sourceSets {
        main {
            res.srcDirs = ['src/main/res',
                           'src/main/res-ad',
                           'src/main/res-play']
        }
}
```

接着同步一下，就会发现这两个文件夹上面的图标和 res 的图标是一样的了。

 ![img](7%EF%BC%8C%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3.assets/9MPAT1%7B4B5WJB%5B83%25EI%7BM.png) 

### Plugin 详解及自定义 Plugin

​		Gradle 插件使用 Groovy 开发的，而 Groovy 完全兼容 Java ，使用 AS 完全可以开发 Gradle 插件。

​		处理插件：Gradle 会自动找到插件的所在位置，如 buildSrc 名字会被 Gradle 识别为 插件工程

​		应用环境：一旦插件被应用到构建的脚本中，那么插件对应的 apply 方法就会被调用





### android 插件对 gradle 扩展



​		在 build.gradle 中，有一个 android 的闭包，在这个闭包中可以的定义非常多的内容。BaseExtension 类就是 闭包中能够调用的所有方法如下：

```java
public abstract class BaseExtension implements AndroidConfig {

    /** Secondary dependencies for the custom transform. */
    private final List<List<Object>> transformDependencies = Lists.newArrayList();

    protected final GlobalScope globalScope;

    private final DefaultConfig defaultConfig;

    private final AaptOptions aaptOptions;

    private final LintOptions lintOptions;

    private final ExternalNativeBuild externalNativeBuild;

    private final DexOptions dexOptions;

    private final TestOptions testOptions;

    private final CompileOptions compileOptions;

    private final PackagingOptions packagingOptions;

    private final JacocoOptions jacoco;

    private final Splits splits;
    
    ......
}
```

​		上面列举了部分的属性。android 闭包中所有的属性方法都是调用这个类里面的。





