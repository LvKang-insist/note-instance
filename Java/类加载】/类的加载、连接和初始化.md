当使用java命令运行某个程序时，该命令会启动一个java虚拟机，不管这个程序有多么复杂，有多少个线程，这个程序都会处于该虚拟机的进程里。同一个jvm的所有线程，所有变量都处于同一个进程里。他们都使用该JVM进程的内存区。当系统出现以下问题时，JVM会被终止：
- 程序正常结束
- 程序运行到使用System.exit()或Runntime.getRuntime().exit()代码处结束程序。
- 程序执行过程中遇到未捕获的异常或错误时结束。
- 程序所在的平台强制结束了JVM进程。



# 类加载的过程分为三个部分：



## 1，加载

​	类加载指的是将类的.Class文件中的二进制数据读入到内存中，将其放在运行时数据区的方法区内，然后在堆里面创建一个对象，用来封装类在方法区内的数据结构。类的加载最终产品是位于堆内中的Class对象，Class对象封装了类在方法取得数据结构，并向程序员提供了访问方法区内的数据结构的接口。

当程序主动初始化某个类的时候，如果该类没有被加载到内存中，则系统会通过类加载、连接、初始化三个步骤来对类进行初始化。如果没有意外，JVM将会连续完成这三个步骤，所以有时也把这三个步骤统称为类的加载或初始化。


类的加载有类的加载器来完成，类加载器通常由JVM提供，这些加载器也是前面所有程序运行的基础，JVM提供的这些类加载器通常被称为类加载器。除此之外，开发者可以通过继承ClassLoader基类来创建自己的类加载器。


通过使用不同的类加载器，可以从不同来源加载二进制数据，通常有以下几种来源：
- 从本地文件系统加载class文件，这是我们经常使用的方式。
- 从Jar包加载class文件，这种方式也是很常见的。
- 通过网络加载class文件
- 把一个java源文件动态编译，并执行加载。

类加载无需等到 首次使用 该类是才加载该类，java虚拟机规范允许预先加载某些类。

## 2，类的连接

当类被加载之后，系统为之生成一个对应的Class对象，接着将会进入连接阶段，连接阶段负责把类的二进制数据文件合并到JRE中，类的连接可分如下三个阶段：

1. 验证：

   ​	验证阶段用于检验被加载的类是否由正确的内部结构，并和其他类协调一致。包括对文件格式的验证，比如常量中是否有不支持的常量。对元数据的验证，对字节码的验证，对符号引用的验证。

2. 准备：

   ​	准备阶段负责为类的类变量分配内存，并设置模式初始值。    注意：对于类变量(static)和全局变量来说，如果不是显式的对其赋值，则系统会为器赋予默认的值，而对于局部变量而言，在使用之前必须显式的为其赋值，否则编译不通过

3. 解析：

   将类的二进制数据中的符号引用替换成直接引用。

   - 符号引用 ：即一个字符串，但是这个字符串给出了一些能够唯一性 识别一个方法，一个变量，一个类相关的信息。

   - 直接引用：可以理解为一个内存地址，或者一个偏移量。比如类方法，类变量的直接引用是指向方法区的指针。而实例变量的直接引用则是从 实例的头指针开始算起到这个实例变量位置的偏移量。

     举一个例子来说：现在调用方法 hello()，这个方法的地址是1234567，那么hello 就是符号引用，1234567就是直接引用。

     在解析阶段，虚拟机 会把所有的类名、方法名、字段名 这些符号引用替换为具体内存地址或偏移量，也就是直接引用。

## 3，类的初始化

在类的初始化阶段，虚拟机负责对类进行初始化，主要就是对类变量进行初始化。在java类中对类变量指定初始值有两种方式：1，声明类变量时指定初始值，2，使用静态初始化块为类变量指定初始化值。
如下所示：

```
public class Test {
    
    //声明类变量时初始化
    static int a = 8;
    static int b;
    
    //使用静态初始化块对变量进行初始化
    static {
        b  =2;
    }
}

```
声明变量时指定初始值，今天初始化块都被当成类的初始化语句。JVM会按这些语句的排列顺序在程序中依次执行他们。


JVM初始化一个类包含如下几个步骤：
1. 假如这个类没有被加载和连接，则程序加载并连接该类。
2. 假如该类的直接父类还没有被初始化，则先初始化其直接父类。
3. 假如类中有初始化语句，则系统一次执行这些初始化语句。

当执行第二步时，系统对直接的父类的初始化步骤也遵循此步骤。如果该类又有直接父类，则系统会再次重复这三个步骤来初始化该类。所以最先初始化的总是java.long.Object类。