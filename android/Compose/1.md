### 简介

`Jetpack Compose` 是用于构建原生 Andorid 界面的新工具包，`Compose` 使用了更少的代码，强大的工具和直观的 Kotlin Api 简化并且加快了 Android 上界面的开发。

在 Compose 中，在构建界面的时候，无需在像之前那么构建 XML 布局，只需要调用 Jetpack Compose 函数来声明你想要的的元素，Compose 编译器就会自动帮你完成后面的工作。

在开始使用 Compose 之前，你需要重新搭建环境，可参考**[官方文档](https://developer.android.google.cn/jetpack/compose/setup)**



### 注解

- @Compose

  所有的组合函数都必须添加 `@Compose` 注解才可以。

  被 `@Compose` 注解的方法只能被同类型的方法调用。

- @Preview

  使用该注解的方法可以不在运行 App 的情况下就可以查看布局。`@Preview` 中常用的参数如下：

  1. `name: String`: 为该Preview命名，该名字会在布局预览中显示。

  2. `showBackground: Boolean`: 是否显示背景，true为显示。

  3. `backgroundColor: Long`: 设置背景的颜色。

  4. `showDecoration: Boolean`: 是否显示Statusbar和Toolbar，true为显示。

  5. `group: String`: 为该Preview设置group名字，可以在UI中以group为单位显示。

  6. `fontScale: Float`: 可以在预览中对字体放大，范围是从0.01。

  7. `widthDp: Int`: 在Compose中渲染的最大宽度，单位为dp。

  8. `heightDp: Int`: 在Compose中渲染的最大高度，单位为dp。

### 组合函数

`Jetpack Compose` 是围绕可组合函数构建的，这些函数就是要显示在界面上的元素，在函数中只需要描述应用界面形状和数据依赖关系，而不用去关系界面的构建过程，

如果需要创建组合函数，只需要将 `@Composeable` 注解添加到对于的函数上即可，需要注意的是组合函数的名称一般都是以大写字母开头的，如下：

```kotlin
class MainActivity : ComponentActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContent {
            PrimaryTheme {
                Surface(
                    modifier = Modifier.fillMaxSize(),
                    color = MaterialTheme.colorScheme.background
                ) {
                    Greeting("Android")
                }
            }
        }
    }
}

@Composable
fun Greeting(name: String) {
    Text(text = "Hello $name!", fontSize = 18.sp, color = Color.Red)
}

@Preview(showBackground = true)
@Composable
fun DefaultPreview() {
    PrimaryTheme {
        Greeting("Android")
    }
}
```

setContent 块 定义了 Activity 的布局，我们不需要去定义 XML 的布局内容，只需要在其中调用组合函数即可。

其中 Test 就是一个非常简单的可组合函数，里面定义了一个 Text，顾名思义，就是用来显示一段文本

并且，我们可以在 Test 函数上添加 @PreView 注释，这样就可以非常方便的进行预览



### 主题

```kotlin
private val DarkColorScheme = darkColorScheme(
    primary = Purple80,
    secondary = PurpleGrey80,
    tertiary = Pink80
)

private val LightColorScheme = lightColorScheme(
    primary = Purple40,
    secondary = PurpleGrey40,
    tertiary = Pink40,
    /* Other default colors to override
    background = Color(0xFFFFFBFE),
    surface = Color(0xFFFFFBFE),
    onPrimary = Color.White,
    onSecondary = Color.White,
    onTertiary = Color.White,
    onBackground = Color(0xFF1C1B1F),
    onSurface = Color(0xFF1C1B1F),
    */
)

@Composable
fun PrimaryTheme(
    darkTheme: Boolean = isSystemInDarkTheme(),
    // Dynamic color is available on Android 12+
    dynamicColor: Boolean = true,
    content: @Composable () -> Unit
) {
    val colorScheme = when {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            val context = LocalContext.current
            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)
        }
        darkTheme -> DarkColorScheme
        else -> LightColorScheme
    }
    val view = LocalView.current
    if (!view.isInEditMode) {
        SideEffect {
            (view.context as Activity).window.statusBarColor = colorScheme.primary.toArgb()
            ViewCompat.getWindowInsetsController(view)?.isAppearanceLightStatusBars = darkTheme
        }
    }

    MaterialTheme(
        colorScheme = colorScheme,
        typography = Typography,
        content = content
    )
}
```

默认的主题定义如上所示，最终会调用 `MaterialTheme`。

Material 主题主要包含三个属性，分别是 颜色，排版，和内容，Api 如下：

```kotlin
@Composable
fun MaterialTheme(
    colors: Colors = MaterialTheme.colors, // 颜色集合
    typography: Typography = MaterialTheme.typography, // 排版集合
    shapes: Shapes = MaterialTheme.shapes, // 形状集合
    content: @Composable () -> Unit // 要展示的内容
)
```

#### 颜色

```kotlin
class Colors(
    primary: Color, // 主颜色，屏幕和元素都用这个颜色
    primaryVariant: Color, // 用于区分主颜色，比如app bar和system bar
    secondary: Color, // 强调色，悬浮按钮，单选/复选按钮，高亮选中的文本，链接和标题
    secondaryVariant: Color, // 用于区分强调色
    background: Color, // 背景色，在可滚动项下面展示
    surface: Color, // 表层色，展示在组件表层，比如卡片，清单和菜单(CardView,SheetLayout,Menu)等
    error: Color, // 错误色，展示错误信息，比如TextField的提示信息
    onPrimary: Color, // 在主颜色primary之上的文本和图标的颜色
    onSecondary: Color, // 在强调色secondary之上的文本和图标的颜色
    onBackground: Color, // 在背景色background之上的文本和图标的颜色
    onSurface: Color, // 在表层色surface之上的文本和图标的颜色
    onError: Color, // 在错误色error之上的文本和图标的颜色
    isLight: Boolean // 是否是浅色模式
) 
```

更多的可以查看 `lightColorScheme` 函数。

#### 排版

```kotlin
class Typography internal constructor(
    val bodyLarge: TextStyle, //  内容大
    val bodyMedium: TextStyle,// 内容中等
    val bodySmall: TextStyle,// 内容小
    val displayLarge: TextStyle,// 显示大号
    val displayMedium: TextStyle,// 显示中等
    val displaySmall: TextStyle,// 显示消耗
    val headlineLarge: TextStyle, // 大标题
    val headlineMedium: TextStyle,// 中标题
    val headlineSmall: TextStyle, // 小标题
    val labelLarge: TextStyle,// 大号标签
    val labelMedium: TextStyle, // 中号标签
    val labelSmall: TextStyle, // 消耗标签
    val titleLarge: TextStyle, // 大号 title
    val titleMedium: TextStyle, // 中号title
    val titleSmall: TextStyle, // 小号title
)
```



#### 形状

```kotlin
class Shapes( 
	// 额外的小形状
    val extraSmall: CornerBasedShape = ShapeTokens.CornerExtraSmall,
    
    // 小组件使用的形状，比如: Button，SnackBar，悬浮按钮等
    val small: CornerBasedShape = RoundedCornerShape(4.dp),
    
    // 中组件使用的形状，比如Card(就是CardView)，AlertDialog等
    val medium: CornerBasedShape = RoundedCornerShape(4.dp),
    
    // 大组件使用的形状，比如ModalDrawer或者ModalBottomSheetLayout(就是抽屉布局和清单布局)
    val large: CornerBasedShape = RoundedCornerShape(0.dp),
    
    // 额外的大形状
    val extraLarge: CornerBasedShape = ShapeTokens.CornerExtraLarge,
)
```



#### 使用

```kotlin
setContent {
    PrimaryTheme {
        Surface(
            modifier = Modifier.fillMaxSize(),
            color = MaterialTheme.colorScheme.background
        ) {
            Greeting("Android")
        }
    }
}
```

```kotlin
@Composable
fun PrimaryTheme(
    themeType: ThemeType = themeTypeState.value,
    content: @Composable () -> Unit
) {
    val shapes = Shapes(
        extraLarge = RoundedCornerShape(100.dp),
        small = RoundedCornerShape(4.dp),
        medium = RoundedCornerShape(8.dp),
        large = RoundedCornerShape(12.dp),
        extraSmall = RoundedCornerShape(20.dp),
    )
    MaterialTheme(
        colorScheme = getThemeForTheme(themeType),
        typography = Typography,
        shapes = shapes,
        content = content
    )
}
```



### UI

#### SetContent

```kotlin
setContent {
    PrimaryTheme {
        Surface(
            modifier = Modifier.fillMaxSize(),
            color = MaterialTheme.colorScheme.background
        ) {
            Greeting("Android")
        }
    }
}
```

同 Android 中的 SetContentView。

#### Theme

创建项目之后，就会生成一个 `项目名称+Theme` 的 `@Compose` 方法，我们可以通过更改其中的颜色来完成对主题的修改。具体如上面的主题所示.



### Modifier

`Modifier` 本质是一个接口，可以用来修饰各种布局，例如 宽高，padding 等，常见的如下：

- padding：有四个重载方法
- plus：将其他的 `Modifer` 加入到当前的 `Modifer` 中。
- fillMaxHeight，fillMaxWidth，fillmaxSize：类似于 `match_parent`，填充整个父 Layout
- with，height，size ：设置宽高度
- rtl，ltr：开始布局的方向
- widthIn，heightIn，sizeIn 设置布局的宽度和高度的最大值和最小值
- gravity：元素的位置，
- 等等

需要注意的是 `Modifier` 系列的方法都支持链式调用



#### Column，Row

类似于 `LinearLayout`，` Column ` 是横向的，`Row` 是竖向的。有四个参数：

- `Modifer`： 具体值如上述所示

- `verticalArrangement`：子元素竖向的排列规则

  常见的就是，上下左右中，比较特殊的就是 

  `SpaceEvenly` 均匀分配，

  `SpaceBetween` 第一个元素前和最后一个元素后没有空隙，其他的按比例放入。

  `SpaceAround` 把整体中的一半空隙凭据放入第一个和最后一个的开始和结束，剩余的一半等比放入各个元素。

- horizontalAlignment：和上面一个，只不过方向不同

- content：要显示的内容

栗子：

```dart
setContent {
    PrimaryTheme {
        Surface(
            modifier = Modifier.fillMaxSize(),
            color = MaterialTheme.colorScheme.background
        ) {
            Column {
                Row {
                    Button(
                        onClick = { themeTypeState.value = ThemeType.RED_THEME },
                        modifier = Modifier.width(100.dp),
                        colors = ButtonDefaults.buttonColors(containerColor = Color.Yellow)
                    ) {
                        Greeting(name = "按钮1")
                    }
                    Button(
                        onClick = { themeTypeState.value = ThemeType.GREEN_THEME },
                        modifier = Modifier.width(100.dp),
                        colors = ButtonDefaults.elevatedButtonColors()
                    ) {
                        Greeting(name = "按钮2")
                    }
                }
                Greeting(name = "Hello Android")
                Greeting(name = "Hello 345")
            }
        }
    }
}
```

![image-20220516233200486](https://cdn.jsdelivr.net/gh/LvKang-insist/PicGo/202205162332552.png)

#### Text

```kotlin
fun Text(
    text: String, //显示内容
    modifier: Modifier = Modifier, //修饰，可修改透明度，边框，背景等
    color: Color = Color.Unspecified, //文字颜色
    fontSize: TextUnit = TextUnit.Unspecified,// size
    fontStyle: FontStyle? = null, //文字样式，粗体，斜体等
    fontWeight: FontWeight? = null,//文字厚度
    fontFamily: FontFamily? = null,//字体
    letterSpacing: TextUnit = TextUnit.Unspecified, //用于与文本相关的维度值的单位。该组件还在测试中
    textDecoration: TextDecoration? = null,//文字装饰，中划线，下划线
    textAlign: TextAlign? = null,对齐方式
    lineHeight: TextUnit = TextUnit.Unspecified,//行高
    overflow: TextOverflow = TextOverflow.Clip,//如何处理溢出，默认裁切
    softWrap: Boolean = true,//是否软换行
    maxLines: Int = Int.MAX_VALUE,//最大行数
    onTextLayout: (TextLayoutResult) -> Unit = {},//计算布局时回调
    style: TextStyle = LocalTextStyle.current //文本的样式配置，如颜色、字体、行高等。
)
```

- modifier：在此处用来修饰 Text，Modifer 提供了很多扩展，如透明度，背景，边框等，如下所示：

  <img src="https://gitee.com/lvknaginist/pic-go-picure-bed/raw/master/images/20210706165654.png" alt="image-20210706165654149" style="zoom:33%;" />

