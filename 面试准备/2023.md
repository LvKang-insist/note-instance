### 自我介绍

面试官你好，我叫吕康，目前一直从事 Android 应用层开发的工作，也有过一些 flutter 开发的经验，到现在工作时间将近四年，主要做过公司业务管理，商城以及社交应用等项目，平时比较喜欢写一写博客，开源库，学一些新的技术，看源码之类的。

我叫吕康，在上家公司的时候是独立开发，主要负责App框架的搭建和正常的日常开发以及App的优化，再上家的时候做过的优化主要是内存优化和体积优化，优化后体积下降25%，内存占用下降 20%。除此之外我喜欢去做一些开源的事情，也会去参与一些社区的事件，我经常在掘金和CSDN发布博客，博客浏览量有20多万，github 的star 也有一百多。对于我自己来说，我的目标是成为 Android 领域的技术专家。很高兴今天能和你一起聊天





### Anr crash

线下：使用 LeakCanary 排查，或者使用 AndroidStudio 的 Profile 火焰图排查。

线上：设置 Looper 的日志打印，我们都知道 Android 的消息都是通过 Looper 走的，检测一下 dispatchMessage 到 print 直接的一个差值，比如说一条消息的时间超过了两秒，那么我们就认为这个消息出现了卡顿，那我们就会把这个消息记录下来保存在本地的一个文件里，进行一个对称加密，当应用在后台的时候进行一个上传，服务器会拿到这些数据进行分析。

2，对于一些线上的 Crash，我们做了一个远程兜底方案，我们知道 Android 的消息都是 Looper 的死循环在做，我们在 App 启动的时候发送了一个 delay 消息，在这个delay 消息里面进行 .loop 操作，相当于我们把原生的 loop 移到了我们 app 内部，

3，对于一些线上的内存泄漏，其实我们是没办法捕获的，此时我们会做一个内存泄漏的兜底，我们会在 Android/Fragment 销毁的时候记录下来，在 60s 后对这个对象进行判断，如果这个对象还存在，就可能出现了内存泄漏，我们会从 View 的根节点开始将他的 listener 和 bitmap 进行移除，从而保证该对象会尽可能的回收掉，这是字节的一个兜底方案。

比较复杂的 ANR 是如何处理的，例如 Single....，对于这种我们会找一下机型尽可能的复现一下，从网上找找方案。

message 为 null 怎么处理，这个主要是看用户日志，当发生异常的时候通过查看日志来看一下主进程到底干了什么事，具体的链路是什么，然后在做处理。



缓慢的内存泄漏要怎么排查

线下：使用 as 的 prfile 检测大内存的情况，然后一一排查

线上：如果线上没有基础设施的话会很难解，如果问题严重，可以考虑发一个灰度版本，里面添加一下组件去检测一下内存泄漏，检测每个页面的内存占用情况，然后再去排查。



协程

线程池



### 体积优化

1，资源压缩，as 自带的，图片改为wedp 格式的

2，混淆，R8，对一下日志代码，无用的代码移除

3，R 文件内联

4，kotlin 的 data class 内联

5，发版本的时候和上个包进行标记，检测差异

6,ASM 的流程



### 绘制优化

1，异步加载 View

2，RecyclerView 预加载

进入页面后，首先会去请求数据，在这个过程中提前去缓存 Viewtype 锁需要的 View，用一个缓存池将其存起来。当 RecyclerView 的数据拿到之后在创建 ViewHolder 的时候，会先从 Rv 的缓存池里面找，取到之后设置给 Rv 的第三层缓存池，然后将自定义的从缓存池里面移除掉，主要是用了一个空间换时间，

正在创建 holder 的时候那个 View 没加载完成怎么办？

在加载 View的时候是一个异步的接口，可以判断他是否加载完成，如果没有的话就将之前的 cancel 掉



### 启动优化

掌阅的 XToC 方案







八股文

- kotlin 中协程的同步问题

- syn 的原理，锁升级降级，轻量级重量级锁等等

- Retforit 流程

- binder

- ASM 和 APT 的区别，

  APT 就是注解处理器， 主要是用来生成代码的，而 ASM 指的就是插桩，我们的 java 代码最终都需要转为 dex，在转换的过程中 ASM 就可以做一些修改工作，ASM 既可以修改代码，也可以生成代码，但是 ASM 的副作用会更大一些，不确定性会更多一些，我们的 ASM 主要用于灰度，线上基本不会使用。

- okr

  每个季度都会有一个预期，每个季度在公司层面都会有一个目标，然后这个目标就会传达到我们领导这边，然后在转成技术目标，比如首先保持我们的业务稳定，然后去做一些优化，技术迭代。然后在同步到我这里，然后根据目标来做开发就行了

- 视频优化

- 你做过最复杂的架构设计是什么

- 你在你们公司处于一个什么位置

  新技术的迭代者和同步者，相比与其他同事，他们的经验可能会更丰富一些，我可能会更善于记录一下事情，热情也会更好一些。

- 你有什么想问的

  一面：团队是干啥的，有多少人，团队的方向

  二面：对于招进来的同学，你们有什么期待吗

  三面：同上，

  四门：业务上的事情，同上

- 为什么要换工作

  对于之前的公司来说，不太适合我未来的发展，我希望找一个平台更大一点，挑战更多一点的公司

- http

  请求码，响应码，tcp/ip 的流程

- glide缓存

- 大图优化

  使用 hook 的方案，无损压缩，有损压缩，png 和 wedp 有什么区别

- 页面秒开

  View 异步加载，绘制层级降级，延时加载



### 项目中比较复杂的地方

- 日志管理

- 网络框架的封装

- 段位升级动画设计

- flutter 应用内悬浮窗的组件

  



### 都做过那些开源项目，项目中最难的是哪里

- flutter floating 悬浮窗

  使用 overlay  来实现 Widiget 在应用内可以显示在最上层，其中比较复杂的就是 悬浮窗的位置定位，以及中线回弹，位置状态缓存，屏幕状态发生改变是悬浮窗的位置调整，例如小屏窗口或者旋转屏幕等。

- android 换肤框架

  1，采用两种方式来设置 factory2，也就是拦截 view 的创建，最常见的就是通过继承实现，还有一种是通过反射实现

  2，通过观察者的方式来实现对已显示的页面进行换肤操作，调用其实现的接口然后通过获取到自定义的 factory 换肤

  3，自定义 Factory，仿照 AppCompatActivity 来实现对 View 的拦截替换，并通过弱引用进行保存，当调用 factory 进行换肤的时候则从 弱引用中获取 view 进行换肤

  4，皮肤的加载策略有四种，默认的，内部存储，zip 包，assets 资源，

  5，通过反射创建 AssetManager 来实现创建皮肤包中的 Resource 资源类，在获取皮肤包资源的时候先通过当前resource 获取到 资源名称以及 type 类型，最后从通过皮肤Resource 获取到资源id 就可以设置皮肤资源了。



